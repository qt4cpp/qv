# ショートカット設定仕様（settings/shortcuts.json）

本書は `settings/shortcuts.json` のスキーマと運用ルールをまとめた開発者向けドキュメントです。
（現状、ショートカットのユーザー上書きは QSettings ではなく、JSON のみです）

対象:
- `settings/shortcuts.json`

---

## 1. 目的

- キーボードショートカットの **デフォルト割り当て**を外部ファイルに切り出し、変更・レビューを容易にする
- UI/操作仕様変更時に、ソースコードのハードコードを避ける

---

## 2. JSON スキーマ（現状）

トップレベルは **オブジェクト（dict）**です。

- キー: アクション名（string）
- 値: キー表現（string）

例（現状の内容）:
```json
{
  "front_view": "a",
  "back_view": "p",
  "left_view": "l",
  "right_view": "r",
  "top_view": "h",
  "bottom_view": "f",
  "open_file": "o"
}
```

---

## 3. アクション名（キー）のルール

- アクション名は **コード側で定義される操作**と一致している必要がある
- アクション名を変更する場合は、以下の影響を必ず確認する
  - UI 操作（メニュー / ツールバー / ボタン）との紐付け
  - ドキュメント・ヘルプの記述
  - 既存ユーザーの運用（手順書、研修資料など）

### 推奨（将来拡張する場合）

- `view.front` / `view.back` のように **namespace 付き**で整理する  
  （※ 現状の実装では未採用）

---

## 4. キー表現（値）のルール

- 現状は **1 文字キー**（例: `"a"`）を使用している
- 将来的に修飾キーを使用する場合は、**Qt の `QKeySequence` 互換表現**に寄せることを推奨する

例:
- `"Ctrl+O"`
- `"Ctrl+Shift+Z"`

---

## 5. 競合（衝突）ポリシー

現状の `shortcuts.json` には、ショートカット衝突を解決するための明示的な仕組みは存在しない。  
そのため、運用上は以下を推奨する。

- 同じキーが **複数のアクションに割り当てられない**ようにする
- PR 時には **差分レビューで衝突がないことを必ず確認**する
- 可能であれば、将来的に **機械的な衝突チェック**（CI 等）を導入する

---

## 6. 変更運用（PR ルール）

ショートカット定義を変更する PR では、以下を必ず記載する。

- どのアクションの割り当てを変更したか
- 変更理由  
  - 例: 操作性向上、他ショートカットとの衝突回避
- 影響範囲  
  - マニュアル
  - 教育・研修資料
  - UI 表示や操作説明

---

## 7. 今後の拡張メモ（設計メモ）

将来的に「ユーザー上書き」を永続化したい場合、以下の設計方針が考えられる。

- デフォルト定義  
  - `settings/shortcuts.json`
- ユーザー上書き  
  - `QSettings` の `shortcuts/<action>` に保存
- 読み込み順  
  - **JSON → QSettings**

その際、以下を導入すると事故が減る。

- ショートカット衝突の自動検出
- コンテキスト概念の導入  
  - 例: `viewer` / `dialog` / `global` など

---

### 補足（現状コードとの差分について）
今回の docs は、あなたが添付した **現状の `app_settings_manager.py` が「DEFAULTS + QSettings」構成**である点に合わせています。  
以前こちらで提案していた **JSON defaults（viewer.json 等）を AppSettings に取り込む設計**は、現状ファイルにはまだ入っていないため、本 docs には「将来メモ」扱いで最小限に留めました。

---